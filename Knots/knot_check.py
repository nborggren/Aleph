h={'paths': {0: [[0.075000000000000011, 0.78333333333333333], [0.27500000000000002, 0.59444444444444444]], 1: [[0.27500000000000002, 0.78333333333333333], [0.075000000000000011, 0.59444444444444444]], 2: [[0.075000000000000011, 0.40555555555555556], [0.27500000000000002, 0.21666666666666667]], 3: [[0.27500000000000002, 0.40555555555555556], [0.075000000000000011, 0.21666666666666667]], 4: [[0.075000000000000011, 0.59444444444444444], [0.075000000000000011, 0.40555555555555556]], 5: [[0.27500000000000002, 0.59444444444444444], [0.27500000000000002, 0.40555555555555556]], 6: [[0.32499999999999996, 0.59444444444444444], [0.52500000000000002, 0.40555555555555556]], 7: [[0.32499999999999996, 0.40555555555555556], [0.52500000000000002, 0.59444444444444444]], 8: [[0.72499999999999998, 0.59444444444444444], [0.92500000000000004, 0.40555555555555556]], 9: [[0.72499999999999998, 0.40555555555555556], [0.92500000000000004, 0.59444444444444444]], 10: [[0.52500000000000002, 0.59444444444444444], [0.72499999999999998, 0.59444444444444444]], 11: [[0.52500000000000002, 0.40555555555555556], [0.72499999999999998, 0.40555555555555556]], 12: [[0.27500000000000002, 0.78333333333333333], [0.32499999999999996, 0.59444444444444444]], 13: [[0.27500000000000002, 0.21666666666666667], [0.32499999999999996, 0.40555555555555556]], 14: [[0.92500000000000004, 0.59444444444444444], [0.5, 0.92500000000000004]], 15: [[0.5, 0.92500000000000004], [0.075000000000000011, 0.78333333333333333]], 16: [[0.92500000000000004, 0.40555555555555556], [0.5, 0.075000000000000011]], 17: [[0.5, 0.075000000000000011], [0.075000000000000011, 0.21666666666666667]]}, 'tangles': {0: [0.17500000000000004, 0.68888888888888888], 1: [0.57499999999999996, 0.68888888888888888], 2: [0.42499999999999999, 0.5], 3: [0.82499999999999996, 0.5]}, 'elevators': {0: 0, 1: 1, 2: 0, 3: 1, 4: 0, 5: 1, 6: 0, 7: 1, 8: 0, 9: 1, 10: 0, 11: 1, 12: 0, 13: 1, 14: 0, 15: 0, 16: 1, 17: 1}, 'corners': {'sw': [0.075000000000000011, 0.21666666666666667], 'ne': [0.92500000000000004, 0.59444444444444444], 'se': [0.92500000000000004, 0.40555555555555556], 'nw': [0.075000000000000011, 0.78333333333333333]}, 'players': {0: 0, 1: 1, 2: 0, 3: 1, 4: 0, 5: 1, 6: 0, 7: 1, 8: 0, 9: 1, 10: 0, 11: 1, 12: 0, 13: 1, 14: 0, 15: 0, 16: 1, 17: 1}, 'points': {0: [0.075000000000000011, 0.59444444444444444], 1: [0.075000000000000011, 0.78333333333333333], 2: [0.27500000000000002, 0.78333333333333333], 3: [0.27500000000000002, 0.59444444444444444], 4: [0.075000000000000011, 0.21666666666666667], 5: [0.075000000000000011, 0.40555555555555556], 6: [0.27500000000000002, 0.40555555555555556], 7: [0.27500000000000002, 0.21666666666666667], 8: [0.52500000000000002, 0.59444444444444444], 9: [0.32499999999999996, 0.59444444444444444], 10: [0.32499999999999996, 0.40555555555555556], 11: [0.52500000000000002, 0.40555555555555556], 12: [0.92500000000000004, 0.59444444444444444], 13: [0.72499999999999998, 0.59444444444444444], 14: [0.72499999999999998, 0.40555555555555556], 15: [0.92500000000000004, 0.40555555555555556]}}


#h={'paths': {0: [[0.075000000000000011, 0.78333333333333333], [0.245, 0.21666666666666667]], 1: [[0.075000000000000011, 0.21666666666666667], [0.245, 0.78333333333333333]], 2: [[0.41500000000000004, 0.78333333333333333], [0.58499999999999996, 0.21666666666666667]], 3: [[0.41500000000000004, 0.21666666666666667], [0.58499999999999996, 0.78333333333333333]], 4: [[0.245, 0.78333333333333333], [0.41500000000000004, 0.78333333333333333]], 5: [[0.245, 0.21666666666666667], [0.41500000000000004, 0.21666666666666667]], 6: [[0.755, 0.78333333333333333], [0.92500000000000004, 0.21666666666666667]], 7: [[0.755, 0.21666666666666667], [0.92500000000000004, 0.78333333333333333]], 8: [[0.58499999999999996, 0.78333333333333333], [0.755, 0.78333333333333333]], 9: [[0.58499999999999996, 0.21666666666666667], [0.755, 0.21666666666666667]], 10: [[0.92500000000000004, 0.78333333333333333], [0.5, 0.92500000000000004]], 11: [[0.5, 0.92500000000000004], [0.075000000000000011, 0.78333333333333333]], 12: [[0.92500000000000004, 0.21666666666666667], [0.5, 0.075000000000000011]], 13: [[0.5, 0.075000000000000011], [0.075000000000000011, 0.21666666666666667]]}, 'tangles': {0: [0.16000000000000003, 0.5], 1: [0.5, 0.5], 2: [0.83999999999999997, 0.5]}, 'elevators': {0: 0, 1: 1, 2: 0, 3: 1, 4: 0, 5: 1, 6: 0, 7: 1, 8: 0, 9: 1, 10: 0, 11: 0, 12: 1, 13: 1}, 'corners': {'sw': [0.075000000000000011, 0.21666666666666667], 'ne': [0.92500000000000004, 0.78333333333333333], 'se': [0.92500000000000004, 0.21666666666666667], 'nw': [0.075000000000000011, 0.78333333333333333]}, 'players': {0: 0, 1: 1, 2: 0, 3: 1, 4: 0, 5: 1, 6: 0, 7: 1, 8: 0, 9: 1, 10: 0, 11: 0, 12: 1, 13: 1}, 'points': {0: [0.245, 0.78333333333333333], 1: [0.075000000000000011, 0.78333333333333333], 2: [0.075000000000000011, 0.21666666666666667], 3: [0.245, 0.21666666666666667], 4: [0.58499999999999996, 0.78333333333333333], 5: [0.41500000000000004, 0.78333333333333333], 6: [0.41500000000000004, 0.21666666666666667], 7: [0.58499999999999996, 0.21666666666666667], 8: [0.92500000000000004, 0.78333333333333333], 9: [0.755, 0.78333333333333333], 10: [0.755, 0.21666666666666667], 11: [0.92500000000000004, 0.21666666666666667]}}






def getElevators(knot):

    elevators = {}
    for j in knot['points'].keys():
        #print knot['points'][j]
        b = [knot['elevators'][i] for i, e in enumerate(knot['paths'].values()) if knot['points'][j] in e]
        if b[0]!=b[1]:
            elevators.update({j:knot['points'][j]})
    return elevators

def isPointElevator(x,y):
    if x in y.values():
        return 1
    else:
        return 0


def makeLoop(knot):
    path = [0]

    while len(path) < len(knot['paths']):
        z = [i for i, e in enumerate(knot['paths'].values()) if (knot['paths'][path[-1]][1] in e) or (knot['paths'][path[-1]][0] in e)]
        #print z
        #print path
        
        i = 0
        while z[i] in path:
            i = i + 1
        path.append(z[i])

#corrects circulation
    for i in range(len(path))[:-1]:
        if  (knot['paths'][path[i]][1]!=knot['paths'][path[i+1]][0]) and (knot['paths'][path[i]][1]==knot['paths'][path[i+1]][1]):
            temp = [knot['paths'][path[i+1]][1],knot['paths'][path[i+1]][0]]
            print len(temp), temp, knot['paths'][path[i+1]]
            knot['paths'][path[i+1]]=temp
            
    for i in range(len(path)):
        print len(knot['paths'][i])

    #for i in range(len(path))[:-1]:
    #    print knot['paths'][path[i]][1],knot['paths'][path[i+1]][0]  

    #zwom = input("sheat")
        
    return path



def getPath(x,y,knot,b):
    #print 'get path' ,b

    xy1 = [i for i, e in enumerate(knot['paths'].values()) if x == e[1]]
    xy2 = [i for i, e in enumerate(knot['paths'].values()) if y == e[0]]
    p1 = [i for i, e in enumerate(b) if e == xy1[0]]
    p2 = [i for i, e in enumerate(b) if e == xy2[0]]

    print x,y
    print p1[0],p2[0], 'p conditions for r'
    #print knot['paths'][xy1[0]]
    print b
    print 'b', b[p1[0]],b[p2[0]]
    for i in b:
        print i,knot['paths'][i]


    
    
    zwom = input("sheat")
    if p1[0]<p2[0]:
        rpath = b[p1[0]:p2[0]+1]    
    elif p1[0]>p2[0]:
        rpath = b[p1[0]:]
        ii = 0
        while ii<=p2[0]:
            rpath.append(b[ii])
            ii=ii+1
    elif p1[0] == p2[0]:
        rpath = [b[p1[0]]]
    

    yx1 = [i for i, e in enumerate(knot['paths'].values()) if x == e[0]]
    yx2 = [i for i, e in enumerate(knot['paths'].values()) if y == e[1]]

    c = []
    for i in range(len(b)):
        c.append(b[-i-1])

    print 'c', c
    print 'b', b

    p1 = [i for i, e in enumerate(c) if e == yx2[0]]
    p2 = [i for i, e in enumerate(c) if e == yx1[0]]

    print p1[0],p2[0], 'p conditions for l'

    if p2[0]<p1[0]:
        lpath = c[p2[0]:p1[0]+1]
    elif p2[0]>p1[0]:
        lpath = c[p2[0]+1:]
        for i in c[:p1[0]]:lpath.append(i)
    elif p2[0]==p1[0]:
        lpath = [c[p1[0]]]
    #print lpath
    
    print 'path between', x,y
    print 'lpath'
    for i in lpath:
        print i,knot['paths'][i]
    print 'rpath'
    for i in rpath:
        print knot['paths'][i]

    return [lpath,rpath]


def getPath2(x,y,knot,b):
    #print 'get path' ,b

    xy1 = [i for i, e in enumerate(knot['paths'].values()) if x in e]
    xy2 = [i for i, e in enumerate(knot['paths'].values()) if y in e]
    p1 = [i for i, e in enumerate(b) if e == xy1[0]]
    p2 = [i for i, e in enumerate(b) if e == xy2[0]]
    print p1,p2,b
    zwom = input("sheat")
    if p1[0]>p2[0]:
        rpath = b[p2[0]+1:p1[0]]    
    else:
        rpath = b[p1[0]+1:p2[0]]    
    print rpath, 'rpath'
    yx1 = [i for i, e in enumerate(knot['paths'].values()) if x in e]
    yx2 = [i for i, e in enumerate(knot['paths'].values()) if y in e]

    c = []
    for i in range(len(b)):
        c.append(b[i-1])
    p1 = [i for i, e in enumerate(c) if e == yx2[0]]
    p2 = [i for i, e in enumerate(c) if e == yx1[0]]

    if p2[0]>p1[0]:
        lpath = c[p2[0]:]
        for i in c[1:p1[0]+1]:lpath.append(i)
    else:
        lpath = c[p1[0]:]
        for i in c[1:p2[0]+1]:lpath.append(i)
    
    print 'path between', x,y
    print 'lpath'
    for i in lpath:
        print knot['paths'][i]
    print 'rpath'
    for i in rpath:
        print knot['paths'][i]


#print lpath
    return [lpath,rpath]

def isTangent(x,y,knot,b):
    #print 'b1', b
    z = getPath(x,y,knot,b)
    #print 'b2',b
    print 'z', z
    print x
    print y
    zwom = input("sheat")

    tl = [knot['players'][j] for j in z[0]]
    print tl

    if min(tl)==max(tl):
        #print 'tangential'
        return 1
    else:
        tr = [knot['players'][j] for j in z[1]]
        print tr
        if min(tr)==max(tr):
            #print 'tangential'
            return 1
        
    #print 'not tangent'
    return 0
    

    

def getTangents(knot):
    elevators = getElevators(knot)
    loop = makeLoop(knot)

    connected = []
    disconnected = []
    for i in elevators.keys():
        for j in elevators.keys():
            #print elevators[i],elevators[j], 'elevators'
            if j>=i:
                continue
            if isTangent(elevators[i],elevators[j],knot,loop)==1:
                connected.append([elevators[i],elevators[j]])
            else:
                disconnected.append([elevators[i],elevators[j]])
    return [connected, disconnected]

    

for i in h['paths'].values():print i
#for j in loops:
#    print h['paths'][j],h['players'][j]

print 'berfore'
loops = makeLoop(h)
for j in loops:
    print h['paths'][j],h['players'][j]
print 'after'



def loopPaths(knot):
    loops = makeLoop(h)
    j2m = {0:'m1',1:'m2'}
    pps = {'m1':[],'m2':[]}
    j = -1
    for i in loops:
        if knot['players'][i] == j:
            ptemp.append(knot['paths'][i][1])
        elif j == -1:
            j = knot['players'][i]
            ptemp = []
            for k in knot['paths'][i]:
                ptemp.append(k)
        else:
            pps[j2m[j]].append(ptemp)
            j = knot['players'][i]
            ptemp = []
            for k in knot['paths'][i]:
                ptemp.append(k)
    return pps

pps = loopPaths(h)    
for i in pps.keys():
    print i
    for j in pps[i]:
        print j
print 'next'
for i in h['paths'].values()[-4:]:print i
for j in loops:
    print h['paths'][j],h['players'][j]

z = getElevators(h)
#print z

#print getPath(h['points'][6],h['points'][9],h,loops)

#b = getTangents(h)

#print 'connected'
#for i in b[0]:print i

#print 'disconnected'
#for i in b[1]:print i




